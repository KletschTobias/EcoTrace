# Database Configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=app
quarkus.datasource.password=app
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/ET
quarkus.datasource.jdbc.max-size=16

# Hibernate Configuration
# WICHTIG: Beim allerersten Start mit drop-and-create, danach auf update ändern!
# Erste Start: quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.database.generation=update
#quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.sql-load-script=import.sql
quarkus.hibernate-orm.log.sql=true

# HTTP Configuration
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# Static Resources (for uploaded profile images)
quarkus.http.body.handle-file-uploads=true
quarkus.http.body.uploads-directory=uploads

# CORS Configuration (Quarkus 3.x syntax)
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:4200,http://localhost:8080
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=24H

# Logging Configuration
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.level=INFO
quarkus.log.category."at.htl".level=DEBUG

# Jackson Configuration
quarkus.jackson.serialization-inclusion=non-null
quarkus.jackson.fail-on-unknown-properties=false

# Keycloak / OIDC
quarkus.oidc.auth-server-url=http://localhost:8081/realms/Eco-Tracer
# Backend akzeptiert Token vom Frontend-Client (ecotrace-frontend)
quarkus.oidc.client-id=ecotrace-frontend
quarkus.oidc.tls.verification=none
# Public endpoints - diese Paths werden NICHT vom OIDC validiert
quarkus.oidc.unverified-paths=/api/activities,/api/activities/*

# Keycloak Admin API (for user deletion)
# Using eco-tracer-api as service account for backend operations
quarkus.keycloak.admin-client-id=eco-tracer-api
quarkus.keycloak.admin-client-secret=1WQYHEwf8DKCwe8yVGc262o40eC0TvdY
quarkus.keycloak.realm=Eco-Tracer
quarkus.keycloak.auth-server-url=http://localhost:8081

# Auth Permissions: OPTIONS ohne Auth (für CORS Preflight), alle anderen Methoden authenticated
quarkus.http.auth.permission.1-cors-preflight.paths=/api/*
quarkus.http.auth.permission.1-cors-preflight.policy=permit
quarkus.http.auth.permission.1-cors-preflight.methods=OPTIONS

# Public endpoint to sync/create users during startup
quarkus.http.auth.permission.2-user-sync.paths=/api/auth/users/sync
quarkus.http.auth.permission.2-user-sync.policy=permit
quarkus.http.auth.permission.2-user-sync.methods=POST

# Public GET /api/activities für alle (Gäste + eingeloggte User)
quarkus.http.auth.permission.3-public-activities.paths=/api/activities,/api/activities/*
quarkus.http.auth.permission.3-public-activities.policy=permit
quarkus.http.auth.permission.3-public-activities.methods=GET,OPTIONS

# Alle anderen API-Pfade benötigen Authentifizierung (muss zuletzt sein!)
quarkus.http.auth.permission.9-api.paths=/api/*
quarkus.http.auth.permission.9-api.policy=authenticated
quarkus.http.auth.permission.9-api.methods=GET,POST,PUT,DELETE